<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Wireless Access Control</title>
<%actInclude("wcb_common.html")%>
</head>

<script language="javascript">

var wl_freq;
var id_freq0, id_command, id_delete_index;
var id_mssididx, id_macenabled, id_mac, id_maccomment;
var maclist_span;
var macselect;
var wac_form;
var apply_btn, delete_btn, deleteall_btn;
var allow_list_num_ssid1=0;
var allow_list_num_ssid2=0;
var aContent = new Array();
var tContent = new Array();

function doLoad()
{
	wl_freq = document.getElementsByName("wl_freq");
	macselect = document.getElementsByName("macselect");
	
	id_freq0 = document.getElementById("id_freq0");
	id_mssididx = document.getElementById("id_mssididx");
	id_macenabled = document.getElementById("id_macenabled");
	id_mac = document.getElementById("id_mac");
	id_maccomment = document.getElementById("id_maccomment");
	maclist_span = document.getElementById("maclist_span");

	id_command = document.getElementById("id_command");
	id_delete_index = document.getElementById("id_delete_index");
	wac_form = document.getElementById("wac_form");
	
	apply_btn = document.getElementById("diy_apply_btn");
	delete_btn = document.getElementById("delete_btn");
	deleteall_btn = document.getElementById("deleteall_btn");
	
	apply_btn.onclick = doApply;
	delete_btn.onclick = doDeleteSelected;
	deleteall_btn.onclick = doDeleteAll;

	delete_btn.style.display = "none";
	deleteall_btn.style.display = "none";

	for(var i = 0; i < wl_freq.length; i++)
	{
		wl_freq[i].onclick = doWlFreq;

		if( ((wl_freq[i].value == "10") && (wlan_idx == 1)) 
			|| ((wl_freq[i].value == "11") && (wlan_idx == 0)))
		{
			wl_freq[i].checked = true;
		}
	}

	if(both_freq == 1)
		id_freq0.checked = true;

	id_mssididx.onchange = doWlFreq;
	id_mssididx.value = curr_ssid;

	doWlFreq();

	WlFAllowNumSsid1();
	WlFAllowNumSsid2();
	init_language();
}

function init_language()
{
	if(cur_lang=="1")
		var surl = "xml/wl_wac_en.xml";
	else
		var surl = "xml/wl_wac_fr.xml";
	StartGetMULLanageXML(surl);
}

function DrawHtml(atemp,ttemp)
{
	 tContent = ttemp;
	 aContent = atemp;


	document.getElementById("wac_title").innerHTML = tContent[0]; 
	document.getElementById("wac_oper_frq").innerHTML = tContent[1]; 
	document.getElementById("wac_frq_both").innerHTML = tContent[2]; 
	document.getElementById("wl_secu_mul_ssid").innerHTML = tContent[3]; 
	document.getElementById("wac_ctr_mode").innerHTML = tContent[4]; 
	document.getElementById("id_macenabled").options[0].innerHTML = tContent[5]; 
	document.getElementById("id_macenabled").options[1].innerHTML = tContent[6]; 
	document.getElementById("id_macenabled").options[2].innerHTML = tContent[7]; 
	document.getElementById("wac_mac").innerHTML = tContent[8]; 
	document.getElementById("wac_comment").innerHTML = tContent[9]; 
	if(document.getElementById("wac_list_ctr2"))
		document.getElementById("wac_list_ctr2").innerHTML = tContent[13];
	if(document.getElementById("wac_macaddr2"))
		document.getElementById("wac_macaddr2").innerHTML = tContent[8];
	if(document.getElementById("wac_comment2"))
		document.getElementById("wac_comment2").innerHTML = tContent[9]; 
	if(document.getElementById("wac_select2"))
		document.getElementById("wac_select2").innerHTML = tContent[10]; 
	document.getElementById("wac_del_sel").innerHTML = tContent[11]; 
	document.getElementById("wac_all_del").innerHTML = tContent[12]; 
	document.getElementById("apply_btn_span").innerHTML = tContent[15];
	if(cur_lang=="1")
	{
		get_top_bottom_en();
		wl_get_Left_en();
	}
	else
	{
		get_top_bottom_fr();
		wl_get_Left_fr();
	}
	
}

function doApply()
{	
	if(trim(id_mac.value) != "")
	{	
		if(!isValidMacAddress(id_mac.value))
		{
			pop_up(aContent[0]);
			id_mac.focus();
			return;
		}
	}

	if(trim(id_maccomment.value) != "")
	{
		if(trim(id_maccomment.value).indexOf("|") != -1)
		{
			pop_up(aContent[1]);
			id_maccomment.focus();
			return;
		}
		if((id_maccomment.value).length > 20)
		{
			pop_up(aContent[2]);
			id_maccomment.focus();
			return;
		}
	}
	
	id_command.value = "apply";
	wac_form.submit();
}

function doDeleteSelected()
{
	var wl_freq_value = "";
	var delete_index_value = "";

	for(var i = 0; i < wl_freq.length; i++)
	{
		if(wl_freq[i].checked)
		{	
			wl_freq_value = wl_freq[i].value; 				
			break;
		}
	}

	var del_num_allow_ssid1=0;
	var del_num_allow_ssid2=0;
	for(var i = 0; i < macselect.length; i++)
	{
		if(macselect[i].checked)
		{			
			var idArray = (macselect[i].id).split("_");
			if(idArray.length == 5)
			{
				var index = idArray[1];
				var freq = idArray[2];
				var ssid = idArray[3];
				var enabled = idArray[4];

				if(ssid=="1"&&enabled=="1")
					del_num_allow_ssid1+=1;
				if(ssid=="2"&&enabled=="1")
					del_num_allow_ssid2+=1;					
				
				if(freq == "0")
					freq = wl_freq_value;				

				delete_index_value += index + "_" + freq + ";"; 	
			}
		}
	}

	id_delete_index.value = delete_index_value;

	if(id_delete_index.value == "")
	{
		pop_up(aContent[3]);	
		return;
	}




	//alert("id1="+allow_list_num_ssid1+";del_num_allow_ssid1="+del_num_allow_ssid1);
	//alert("id1="+allow_list_num_ssid2+";del_num_allow_ssid2="+del_num_allow_ssid2);

	if((allow_list_num_ssid1<=del_num_allow_ssid1&&del_num_allow_ssid1>0)||(allow_list_num_ssid2<=del_num_allow_ssid2&&del_num_allow_ssid2>0))
	{
		if(allow_list_num_ssid1<=del_num_allow_ssid1&&del_num_allow_ssid1>0)
		{
			if(!confirm(aContent[6]))
				return;
		}
		if(allow_list_num_ssid2<=del_num_allow_ssid2&&del_num_allow_ssid2>0)
		{
			if(!confirm(aContent[7]))
				return;
		}
		id_command.value = "delete";
		wac_form.submit();
	}
	else
	pop_up(aContent[4], 1, function(){
		
		id_command.value = "delete";
		wac_form.submit();
	});	
}

function doDeleteAll()
{

	var wl_freq_value = "";
	var delete_index_value = "";

	for(var i = 0; i < wl_freq.length; i++)
	{
		if(wl_freq[i].checked)
		{	
			wl_freq_value = wl_freq[i].value; 				
			break;
		}
	}

	var del_num_allow_ssid1=0;
	var del_num_allow_ssid2=0;
	for(var i = 0; i < macselect.length; i++)
	{			
			var idArray = (macselect[i].id).split("_");
			if(idArray.length == 5)
			{
				var index = idArray[1];
				var freq = idArray[2];
				var ssid = idArray[3];
				var enabled = idArray[4];

				if(ssid=="1"&&enabled=="1")
					del_num_allow_ssid1+=1;
				if(ssid=="2"&&enabled=="1")
					del_num_allow_ssid2+=1;					
				
				if(freq == "0")
					freq = wl_freq_value;				

				delete_index_value += index + "_" + freq + ";"; 	
			}		
	}


	//alert("id1="+allow_list_num_ssid1+";del_num_allow_ssid1="+del_num_allow_ssid1);
	//alert("id1="+allow_list_num_ssid2+";del_num_allow_ssid2="+del_num_allow_ssid2);
	if((allow_list_num_ssid1<=del_num_allow_ssid1&&del_num_allow_ssid1>0)||(allow_list_num_ssid2<=del_num_allow_ssid2&&del_num_allow_ssid2>0))
	{
		if(allow_list_num_ssid1<=del_num_allow_ssid1&&del_num_allow_ssid1>0)
		{
			if(!confirm(aContent[8]))
				return;
		}
		if(allow_list_num_ssid2<=del_num_allow_ssid2&&del_num_allow_ssid2>0)
		{
			if(!confirm(aContent[9]))
				return;
		}
		id_command.value = "deleteall";
		wac_form.submit();
	}
	else
	pop_up(aContent[5], 1, function(){

		id_command.value = "deleteall";
		wac_form.submit();
	});
}


function doWlFreq()
{	
	var params = "";
	
	for(var i = 0; i < wl_freq.length; i++)
	{
		if(wl_freq[i].checked)
		{	
			params += "&wl_freq=" + wl_freq[i].value; 				
			break;
		}
	}	

	params += "&wl_mssididx=" + id_mssididx.value;
	params += "&command=getlist";	

	ajaxPost("wlwac.cgi", params, resGetList);
}

function change_creat_list_french()
{
	if(cur_lang == "2")
	{
		document.getElementById("wac_cur_list").innerHTML = "Liste de contrôle de l'accès actuelle"; 
		if(id_freq0.checked)
			document.getElementById("wac_list_frq").innerHTML ="Fréquence"; 
		document.getElementById("wac_list_mac").innerHTML = "Adresse MAC";
		document.getElementById("wac_list_comment").innerHTML = "Commentaire"; 
		document.getElementById("wac_list_select").innerHTML = "Sélectionner";
	}
}

function WlFAllowNumSsid1()
{	
	var params = "";
		
	params += "&wl_freq=0";
	params += "&wl_mssididx=1";
	params += "&command=getlist";	
	ajaxPost("wlwac.cgi", params, CountAllowNumSsid1);
}

function WlFAllowNumSsid2()
{	
	var params = "";
		
	params += "&wl_freq=0";
	params += "&wl_mssididx=2";
	params += "&command=getlist";	
	ajaxPost("wlwac.cgi", params, CountAllowNumSsid2);
}


function CountAllowNumSsid1(message)
{
    var array=message;
	var ssid_num=0;
    if(array!="0")    
	{
       for(var i=0;i<array.split('||').length-1;i++)
		{
		  if(array.split('||')[i].split('|')[5]=="1")
           ssid_num++;
		}
	   allow_list_num_ssid1=ssid_num;
    }
	//alert("sid1="+allow_list_num_ssid1);
	return;
}

function CountAllowNumSsid2(message)
{
	var array=message;
	var ssid_num=0;
    if(array!="0")
    	{
		for(var i=0;i<array.split('||').length-1;i++)
		{
		  if(array.split('||')[i].split('|')[5]=="1")
          ssid_num++;
		}
		allow_list_num_ssid2=ssid_num;
    }
	//alert("sid2="+allow_list_num_ssid2);
	return;
}

function createMacList()
{
	var tr = "<table cellpadding=\"0\" cellspacing=\"1\" border=\"0\" width=\"440px\">";
	
	tr += "<tr><td colspan=\"4\"><strong><span id='wac_cur_list' style='font-weight:bold;font-size:12px;'>Current Access Control List</span>:</strong></td></tr>";
	tr += "<tr>";
	
	if(id_freq0.checked)
		tr += "<td align=\"center\" width=\"10%\" bgcolor=\"#3f78ad\"><strong class=\"white\"><span id='wac_list_frq' style='font-weight:bold;font-size:12px;'>Frequency</span></strong></td>";
	
	tr += "<td align=\"center\" width=\"25%\" bgcolor=\"#3f78ad\"><strong class=\"white\"><span id='wac_list_mac' style='font-weight:bold;font-size:12px;'>MAC Address</span></strong></td>";
	tr += "<td align=\"center\" width=\"25%\" bgcolor=\"#3f78ad\"><strong class=\"white\"><span id='wac_list_comment' style='font-weight:bold;font-size:12px;'>Comment</span></strong></td>";
	tr += "<td align=\"center\" width=\"25%\" bgcolor=\"#3f78ad\"><strong class=\"white\"><span id='wac_list_access' style='font-weight:bold;font-size:12px;'>Access</span></strong></td>";
	tr += "<td align=\"center\" width=\"15%\" bgcolor=\"#3f78ad\"><strong class=\"white\"><span id='wac_list_select' style='font-weight:bold;font-size:12px;'>Select</span></strong></td>";
	tr += "</tr>";
	return tr;
}

function resGetList(message)
{
	var mac;
	var comment;
	var freq;
	var index;
	var wac_mode = new Array();
	var tr = createMacList();
	var array = message;

		if(array.length > 2 )
		{
			var messageArray = array.split("||");
			if(messageArray.length > 1)
			{			
				delete_btn.style.display = "block";
				deleteall_btn.style.display = "block";
				
				for(var i = 0; i < messageArray.length - 1; i++)
				{
					var wacArray = messageArray[i].split("|");

					if(wacArray[0])
						mac = wacArray[0];
					else
						mac = "";
					
					if(wacArray[1])
						comment = wacArray[1];	
					else
						comment = "";

					if(comment == "NULL")
						comment = "";

					if(wacArray[2])
						freq = wacArray[2];
					else
						freq = "0";

					if(wacArray[3])
						index = wacArray[3];
					else
						index = "1";

					var bgcolor = "#E0E5F1";
					if(i % 2 == 0)
						bgcolor = "#F1F3F9";					
					
					tr += "<tr>";

					if(id_freq0.checked)
					{
						if(freq != "" && freq != "0")
						{
							tr += "	<td align=\"center\" width=\"10%\" bgcolor=\""+bgcolor+"\">";

							if(freq == "10")
								tr += "2.4G";
							else if(freq == "11")
								tr += "5G";

							tr += "</td>";
						}	
					}

					if(wacArray[5] == "0")
						var wac_access_value = "Access Disabled";
					else if(wacArray[5] == "1")
						var wac_access_value = "Access Allowed";
					else if(wacArray[5] == "2")
						var wac_access_value = "Access Denied";
					
					tr += "	<td align=\"center\" width=\"25%\" bgcolor=\""+bgcolor+"\">" + mac + "</td>";
					tr += "	<td align=\"center\" width=\"25%\" bgcolor=\""+bgcolor+"\">" + comment + "</td>";
					tr += "	<td align=\"center\" width=\"25%\" bgcolor=\""+bgcolor+"\">" + wac_access_value + "</td>";
					tr += "	<td align=\"center\" width=\"15%\" bgcolor=\""+bgcolor+"\">";
					tr += "		<input type=\"radio\" name=\"macselect\" id=\"select_" + index + "_" + freq + "_" + wacArray[4] + "_" + wacArray[5] + "\" value=\"ON\"></td>";
					tr += "</tr>";	
					wac_mode[i] = wacArray[5];
				}				
			}

			
		if(freq == "0")
			id_macenabled.value = array.split("||")[0].split("|")[5];
		else
			{		      
				var have_applyed_both = "1";
			        for(var i = 0;i < wac_mode.length;i++)
			        {
                                        if(wac_mode[0] != wac_mode[i])
					        have_applyed_both = "0";
				}

                                if(have_applyed_both == "1")
				        id_macenabled.value = wac_mode[0];      //wac_mode[0] value:  0->disable  1->allow  2->deny
				else
				        id_macenabled.value = "0";
			}
		}
		else
			id_macenabled.value = array;

	tr += "</table>";
	maclist_span.innerHTML = tr;
	change_creat_list_french();
	id_mac.value = "";
	id_maccomment.value = "";
	id_mac.focus();	
}

</script>


<body>
	<div id="wrapper">    
		<%actInclude("top_nav.html")%>    
		<%actInclude("left_wl.html")%>
		
		<div id="content_right">
		    <div id="content_right_header"></div>
		    <div id="content_right_contentarea">
	        	<h1><span id="wac_title" style='font-weight:bold;font-size:16px;'>Wireless Access Control</span></h1>

				<form id="wac_form" method="POST" action="wlwac.cgi">
				<input type="hidden" name="command" id="id_command" value="apply" />
		 	    <input type="hidden" name="mypage" value="/wl_wac.html" />
				<input type="hidden" name="delete_index" id="id_delete_index" />
		 	    
		 	    
				<table cellpadding="0" cellspacing="2" border="0">
					<tr>
						<td width="250"><label><span id="wac_oper_frq">Wireless Operation Frequency</span>:</label></td>
						<td>
							<input name="wl_freq" id="id_freq2" type="radio" value="10" checked="checked"/> 
				  			<label for="id_freq2">2.4GHz</label>             
             				<input name="wl_freq" id="id_freq5" type="radio" value="11" />
              	  			<label for="id_freq5">5GHz</label> 
              	  			<input name="wl_freq" id="id_freq0" type="radio" value="0" />
              	  			<label for="id_freq0"><span id="wac_frq_both">Both</span></label>
              			</td>
					</tr>
					<%actInclude("aop_ssid_select.html")%>
					<tr>
						<td><label for="id_macenabled"><span id="wac_ctr_mode">Wireless Access Control Mode</span>:</label></td>
						<td>
							<select size="1" name="wl_macenabled" id="id_macenabled">
					          <option value="0">Disable&nbsp;</option>
					          <option value="1" selected >Allow Listed&nbsp;</option>
					          <option value="2">Deny Listed&nbsp;</option>
					        </select>
					    </td>
					</tr>
					<tr>
						<td><label for="id_mac"><span id="wac_mac">MAC Address</span>:</label></td>
						<td><input type="text" name="wl_mac" id="id_mac" size="20" maxlength="17" style="height: 16px"/></td>
					</tr>
					<tr>
						<td><label for="id_maccomment"><span id="wac_comment">Comment</span>:</label></td>
						<td><input type="text" name="wl_maccomment" id="id_maccomment" size="20" maxlength="20" style="height: 16px"/></td>
					</tr>
					<tr>
						<td width="220">&nbsp;</td>
						<td>
							<div><a class="button" href="###" id="diy_apply_btn"><span id="apply_btn_span">Apply</span></a></div>
						</td>
					</tr>
				</table>

				<span id="maclist_span">
					<br>
					<table cellpadding="0" cellspacing="1" border="0" width="440px">
					  <tr><td><strong><span id="wac_list_ctr2">Current Access Control List</span>:</strong></td></tr>
					  <tr>
					  	<td align="center" width="30%" bgcolor="#3f78ad"><strong class="white"><span id="wac_macaddr2">MAC Address</span></strong></td>
					  	<td align="center" width="30%" bgcolor="#3f78ad"><strong class="white"><span id="wac_comment2">Comment</span></strong></td>
					  	<td align="center" width="25%" bgcolor="#3f78ad"><strong class="white"><span id="wac_access2">Access</span></strong></td>
					  	<td align="center" width="15%" bgcolor="#3f78ad"><strong class="white"><span id="wac_select2">Select</span></strong></td>
					  </tr>				  				  
					</table>
				</span>
				</form>
				
				<table cellpadding="0" cellspacing="2" border="0">
					<tr>
						<td>
							<a href="###" class="action" id="delete_btn"><span id="wac_del_sel">Delete Selected</span></a> 
						</td>
						<td>
							<a href="###" class="action" id="deleteall_btn"><span id="wac_all_del">Delete All</span></a>
						</td>
					</tr>
				</table>

				<br><br>
	        	<div class="clear_left"></div>
	        </div>
	        <div id="content_right_footer"></div>
		</div>
        <div class="clear_left"></div>
   		<%actInclude("wcb_footer.html")%>
	</div>
</body>
</html>
